<h3>VirusTotal Domain Report for {{ r.field.value }}</h3>

{% if r.error %}
  <p style="color:red;">{{ r.error }}</p>
{% endif %}

{% if r.result %}
  {% with attr=r.result.attributes %}
    <table>
      <!-- <tr><th>Domain</th><td>{{ r.result.id }}</td></tr> -->
      <tr><th>Registrar</th><td>{{ attr.registrar }}</td></tr>
      <tr><th>Registration Date</th>
        <td>{% if r.registration_date %} {{ r.registration_date }} {% else %} N/A {% endif %}</td>
      </tr>
      <tr><th>Last Analysis Date</th>
        <td>{% if r.last_analysis_date %} {{ r.last_analysis_date|date:"Y-m-d H:i" }} UTC {% else %} N/A {% endif %}</td>
      </tr>
      <tr><th>Reputation</th><td>{{ attr.reputation }}</td></tr>
      <tr><th>Harmless</th><td>{{ attr.last_analysis_stats.harmless }}</td></tr>
      <tr><th>Malicious</th><td>{{ attr.last_analysis_stats.malicious }}</td></tr>
      <tr><th>Suspicious</th><td>{{ attr.last_analysis_stats.suspicious }}</td></tr>
      <tr><th>Undetected</th><td>{{ attr.last_analysis_stats.undetected }}</td></tr>
      <tr><th>Vendors Flagged</th><td>{{ r.flagged_vendors }}</td></tr>
    </table>
  {% endwith %}
{% endif %}

{% if r.crowdsourced_context %}
  <h4>Crowdsourced Context</h4>
  <table>
    <tr><th>Title</th><th>Details</th><th>Severity</th><th>Source</th><th>Timestamp</th></tr>
    {% for ctx in r.crowdsourced_context %}
    <tr>
      <td>{{ ctx.title }}</td>
      <td>{{ ctx.details }}</td>
      <td>{{ ctx.severity }}</td>
      <td>{{ ctx.source }}</td>
      <td>
        {% if ctx.timestamp %}
          {{ ctx.timestamp|date:"Y-m-d H:i" }} UTC
        {% else %}
          N/A
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </table>
{% endif %}

{% if r.whois %}
  <h4>WHOIS Data</h4>
  <pre style="background:#f4f4f4; padding:10px; border:1px solid #ccc; white-space:pre-wrap;">
{{ r.whois }}
  </pre>
{% endif %}

{% if r.gui_url %}
  <p><a href="{{ r.gui_url }}" target="_blank" rel="noopener">View Domain on VirusTotal</a></p>
{% endif %}
