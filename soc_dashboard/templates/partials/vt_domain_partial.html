<h3>VirusTotal Domain Report for {{ r.field.value }}</h3>

{% if r.error %}
  <p style="color:red;">{{ r.error }}</p>
{% endif %}

{% if r.result %}
  {% with attr=r.result.attributes %}
    <table style="border-collapse: collapse; width: 40%; margin-bottom: 10px;">
      <tr>
        <th style="border: 1px solid #000; background: #f2f2f2;">Registrar</th>
        <td style="border: 1px solid #000;">{{ attr.registrar }}</td>
      </tr>
      <tr>
        <th style="border: 1px solid #000; background: #f2f2f2;">Registration Date</th>
        <td style="border: 1px solid #000;">
          {% if r.registration_date %} {{ r.registration_date }} {% else %} N/A {% endif %}
        </td>
      </tr>
      <tr>
        <th style="border: 1px solid #000; background: #f2f2f2;">Last Analysis Date</th>
        <td style="border: 1px solid #000;">
          {% if r.last_analysis_date %} {{ r.last_analysis_date|date:"Y-m-d H:i" }} UTC {% else %} N/A {% endif %}
        </td>
      </tr>
      <tr>
        <th style="border: 1px solid #000; background: #f2f2f2;">Reputation</th>
        <td style="border: 1px solid #000;">{{ attr.reputation }}</td>
      </tr>
      <tr>
        <th style="border: 1px solid #000; background: #f2f2f2;">Harmless</th>
        <td style="border: 1px solid #000;">{{ attr.last_analysis_stats.harmless }}</td>
      </tr>
      <tr>
        <th style="border: 1px solid #000; background: #f2f2f2;">Malicious</th>
        <td style="border: 1px solid #000;">{{ attr.last_analysis_stats.malicious }}</td>
      </tr>
      <tr>
        <th style="border: 1px solid #000; background: #f2f2f2;">Suspicious</th>
        <td style="border: 1px solid #000;">{{ attr.last_analysis_stats.suspicious }}</td>
      </tr>
      <tr>
        <th style="border: 1px solid #000; background: #f2f2f2;">Undetected</th>
        <td style="border: 1px solid #000;">{{ attr.last_analysis_stats.undetected }}</td>
      </tr>
      <tr>
        <th style="border: 1px solid #000; background: #f2f2f2;">Vendors Flagged</th>
        <td style="border: 1px solid #000;">{{ r.flagged_vendors }}</td>
      </tr>
    </table>
  {% endwith %}
{% endif %}

{% if r.crowdsourced_context %}
  <h4>Crowdsourced Context</h4>
  <table style="border-collapse: collapse; width: 90%; margin-bottom: 10px;">
    <tr>
      <th style="border: 1px solid #000; background: #f2f2f2;">Title</th>
      <th style="border: 1px solid #000; background: #f2f2f2;">Details</th>
      <th style="border: 1px solid #000; background: #f2f2f2;">Severity</th>
      <th style="border: 1px solid #000; background: #f2f2f2;">Source</th>
      <th style="border: 1px solid #000; background: #f2f2f2;">Timestamp</th>
    </tr>
    {% for ctx in r.crowdsourced_context %}
    <tr>
      <td style="border: 1px solid #000;">{{ ctx.title }}</td>
      <td style="border: 1px solid #000;">{{ ctx.details }}</td>
      <td style="border: 1px solid #000;">{{ ctx.severity }}</td>
      <td style="border: 1px solid #000;">{{ ctx.source }}</td>
      <td style="border: 1px solid #000;">
        {% if ctx.timestamp %}
          {{ ctx.timestamp|date:"Y-m-d H:i" }} UTC
        {% else %}
          N/A
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </table>
{% endif %}

{% if r.whois %}
  <h4>WHOIS Data</h4>
  <pre style="background:#f4f4f4; padding:10px; border:1px solid #ccc; white-space:pre-wrap;">
{{ r.whois }}
  </pre>
{% endif %}

{% if r.gui_url %}
  <p><a href="{{ r.gui_url }}" target="_blank" rel="noopener">View Domain on VirusTotal</a></p>
{% endif %}
